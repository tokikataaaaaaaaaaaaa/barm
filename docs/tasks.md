# BARM タスク分解

**バージョン:** 1.0
**作成日:** 2026-01-02

---

## 進捗サマリー

| 指標 | 値 |
|------|-----|
| 全タスク数 | 52 |
| 完了 | 0 |
| 進行中 | 0 |
| 未着手 | 52 |
| ブロッカー | 0 |

---

## Phase 1: 認証・ユーザー管理

### 目標
- Apple Sign Inによるユーザー認証の実装
- ユーザープロフィール管理機能の構築
- 認証状態の永続化

### タスク

#### T001: Flutter プロジェクトセットアップ
- **対応機能:** 基盤
- **完了基準:**
  - [ ] Flutter プロジェクト作成（iOS対象）
  - [ ] ディレクトリ構造確立（feature-first）
  - [ ] Riverpod 導入・設定完了
  - [ ] `flutter run` でiOSシミュレータ起動成功
- **依存:** なし
- **ステータス:** 未着手

#### T002: Firebase プロジェクト設定
- **対応機能:** 基盤
- **完了基準:**
  - [ ] Firebase プロジェクト作成
  - [ ] iOS アプリ登録（Bundle ID 設定）
  - [ ] `GoogleService-Info.plist` 配置
  - [ ] Firebase SDK 初期化コード追加
  - [ ] Firebase 接続テスト成功
- **依存:** T001
- **ステータス:** 未着手

#### T003: Firestore セキュリティルール設計
- **対応機能:** 非機能要件（セキュリティ）
- **完了基準:**
  - [ ] users コレクションのルール定義（自分のみ読み書き可能）
  - [ ] missions コレクションのルール定義
  - [ ] records コレクションのルール定義
  - [ ] groups コレクションのルール定義（メンバーのみ読み取り可能）
  - [ ] Firebase Emulator でルールテスト通過
- **依存:** T002
- **ステータス:** 未着手

#### T004: Apple Sign In 実装
- **対応機能:** F-001
- **完了基準:**
  - [ ] `sign_in_with_apple` パッケージ導入
  - [ ] Apple Developer で Sign In with Apple 有効化
  - [ ] Firebase Auth と Apple Sign In 連携設定
  - [ ] ログインボタン押下でApple認証画面表示
  - [ ] 認証成功後、Firebase Auth に UID 登録
- **依存:** T002
- **ステータス:** 未着手

#### T005: ユーザーデータモデル作成
- **対応機能:** F-001
- **完了基準:**
  - [ ] User エンティティクラス定義
  - [ ] Firestore用 toJson/fromJson 実装
  - [ ] UserRepository インターフェース定義
  - [ ] FirestoreUserRepository 実装
  - [ ] ユニットテスト通過
- **依存:** T002
- **ステータス:** 未着手

#### T006: ニックネーム設定画面実装
- **対応機能:** F-001（S-003）
- **完了基準:**
  - [ ] ニックネーム入力フォーム表示
  - [ ] 入力バリデーション（1〜20文字、空白禁止）
  - [ ] 保存ボタン押下で Firestore に保存
  - [ ] 保存成功後ホーム画面へ遷移
- **依存:** T004, T005
- **ステータス:** 未着手

#### T007: 認証状態管理 Provider 実装
- **対応機能:** F-001
- **完了基準:**
  - [ ] AuthStateProvider 作成
  - [ ] ログイン状態の監視（StreamProvider）
  - [ ] 認証状態に応じた画面遷移ロジック
  - [ ] アプリ再起動後もログイン状態維持確認
- **依存:** T004
- **ステータス:** 未着手

#### T008: ログアウト機能実装
- **対応機能:** F-001
- **完了基準:**
  - [ ] ログアウトボタン配置
  - [ ] Firebase Auth サインアウト実行
  - [ ] ログイン画面への遷移
  - [ ] ローカルキャッシュクリア
- **依存:** T007
- **ステータス:** 未着手

#### T009: スプラッシュ画面実装
- **対応機能:** S-001
- **完了基準:**
  - [ ] アプリアイコン表示
  - [ ] 認証状態チェック中のローディング表示
  - [ ] 認証済み → ホーム、未認証 → ログイン画面へ自動遷移
- **依存:** T007
- **ステータス:** 未着手

### Phase 1 完了基準
- [ ] 全タスク（T001〜T009）完了
- [ ] Apple Sign In でログイン・ログアウトが正常動作
- [ ] ニックネーム設定が Firestore に保存される
- [ ] アプリ再起動後もログイン状態が維持される

---

## Phase 2: ミッション設定・トラッキング

### 目標
- ミッションのCRUD機能実装
- 日々の記録入力・保存機能
- 達成率とストリーク表示

### タスク

#### T010: Mission データモデル作成
- **対応機能:** F-002
- **完了基準:**
  - [ ] Mission エンティティ定義（id, userId, type, name, targetValue, unit, isActive, createdAt）
  - [ ] toJson/fromJson 実装
  - [ ] MissionRepository インターフェース定義
  - [ ] FirestoreMissionRepository 実装
  - [ ] ユニットテスト通過
- **依存:** T002
- **ステータス:** 未着手

#### T011: Record データモデル作成
- **対応機能:** F-003
- **完了基準:**
  - [ ] Record エンティティ定義（id, userId, missionId, value, recordedAt, createdAt）
  - [ ] toJson/fromJson 実装
  - [ ] RecordRepository インターフェース定義
  - [ ] FirestoreRecordRepository 実装
  - [ ] ユニットテスト通過
- **依存:** T002
- **ステータス:** 未着手

#### T012: ミッション作成画面実装
- **対応機能:** F-002（S-005）
- **完了基準:**
  - [ ] ミッション名入力フォーム
  - [ ] 目標値入力フィールド
  - [ ] 単位選択（回、分、ページなど）
  - [ ] タイプ選択（筋トレ/勉強）
  - [ ] 保存ボタンで Firestore に保存
  - [ ] 最大10個制限のバリデーション
- **依存:** T010, T006
- **ステータス:** 未着手

#### T013: ミッション一覧表示実装
- **対応機能:** F-002
- **完了基準:**
  - [ ] ユーザーのミッション一覧取得（StreamProvider）
  - [ ] リスト表示（名前、目標、タイプ）
  - [ ] 空状態の表示（ミッションなし時）
  - [ ] ミッション追加ボタン表示
- **依存:** T010
- **ステータス:** 未着手

#### T014: ミッション編集・削除機能実装
- **対応機能:** F-002（S-006）
- **完了基準:**
  - [ ] ミッション詳細画面への遷移
  - [ ] 編集フォーム表示（名前、目標値、単位変更）
  - [ ] 更新ボタンで Firestore 更新
  - [ ] 削除ボタン + 確認ダイアログ
  - [ ] 削除実行で Firestore から削除
- **依存:** T012, T013
- **ステータス:** 未着手

#### T015: ホーム画面（今日のミッション）実装
- **対応機能:** F-003（S-004）
- **完了基準:**
  - [ ] 今日の日付表示
  - [ ] アクティブなミッション一覧表示
  - [ ] 各ミッションの今日の達成状況表示
  - [ ] 達成入力エリア（スライダー or 数値入力）
- **依存:** T013
- **ステータス:** 未着手

#### T016: 記録入力機能実装
- **対応機能:** F-003
- **完了基準:**
  - [ ] ミッションごとに達成値入力可能
  - [ ] 入力値の即時保存（Firestore）
  - [ ] 同日の記録は上書き（新規作成ではなく更新）
  - [ ] 保存成功のフィードバック表示
- **依存:** T011, T015
- **ステータス:** 未着手

#### T017: 達成率計算・表示実装
- **対応機能:** F-003
- **完了基準:**
  - [ ] 達成率（達成値/目標値）計算ロジック
  - [ ] 100%超えの場合も表示
  - [ ] プログレスバー表示
  - [ ] 達成時の視覚的フィードバック（色変化、アイコン）
- **依存:** T016
- **ステータス:** 未着手

#### T018: ストリーク（連続達成日数）計算実装
- **対応機能:** F-003
- **完了基準:**
  - [ ] 連続達成日数の計算ロジック（100%以上で達成とカウント）
  - [ ] ストリーク表示UI
  - [ ] 全ミッション統合ストリーク計算
  - [ ] ユニットテスト通過
- **依存:** T011
- **ステータス:** 未着手

#### T019: 過去の記録閲覧機能実装
- **対応機能:** F-003（S-006）
- **完了基準:**
  - [ ] カレンダー表示（月単位）
  - [ ] 日付タップで当日の記録表示
  - [ ] 達成/未達成の視覚的区別
  - [ ] 月間達成率の表示
- **依存:** T016, T017
- **ステータス:** 未着手

### Phase 2 完了基準
- [ ] 全タスク（T010〜T019）完了
- [ ] ミッションのCRUD操作が正常動作
- [ ] 記録入力・保存が正常動作
- [ ] 達成率とストリークが正しく表示される

---

## Phase 3: グループ・仲間機能

### 目標
- グループ作成・参加機能
- メンバーの記録共有
- リアルタイムデータ同期

### タスク

#### T020: Group データモデル作成
- **対応機能:** F-004
- **完了基準:**
  - [ ] Group エンティティ定義（id, name, inviteCode, ownerId, createdAt）
  - [ ] GroupMember サブコレクション定義
  - [ ] toJson/fromJson 実装
  - [ ] GroupRepository インターフェース定義
  - [ ] FirestoreGroupRepository 実装
  - [ ] ユニットテスト通過
- **依存:** T002
- **ステータス:** 未着手

#### T021: 招待コード生成ロジック実装
- **対応機能:** F-004
- **完了基準:**
  - [ ] 6桁英数字のランダム生成
  - [ ] 重複チェック（Firestore クエリ）
  - [ ] 一意性保証
  - [ ] ユニットテスト通過
- **依存:** T020
- **ステータス:** 未着手

#### T022: グループ作成画面実装
- **対応機能:** F-004（S-008）
- **完了基準:**
  - [ ] グループ名入力フォーム
  - [ ] 作成ボタン押下で Firestore 保存
  - [ ] 招待コード自動生成・表示
  - [ ] 招待コードのコピーボタン
  - [ ] 作成者は自動的にメンバー登録
- **依存:** T020, T021
- **ステータス:** 未着手

#### T023: グループ参加画面実装
- **対応機能:** F-004（S-009）
- **完了基準:**
  - [ ] 招待コード入力フォーム
  - [ ] 参加ボタン押下でコード検証
  - [ ] 無効コード時のエラー表示
  - [ ] 満員（5人）時のエラー表示
  - [ ] 参加成功で members サブコレクションに追加
- **依存:** T020
- **ステータス:** 未着手

#### T024: グループ所属状態管理実装
- **対応機能:** F-004
- **完了基準:**
  - [ ] ユーザーの所属グループ取得
  - [ ] 1ユーザー1グループ制限のバリデーション
  - [ ] グループ未所属時の状態管理
  - [ ] GroupStateProvider 作成
- **依存:** T020, T007
- **ステータス:** 未着手

#### T025: グループ退出機能実装
- **対応機能:** F-004
- **完了基準:**
  - [ ] 退出ボタン配置
  - [ ] 確認ダイアログ表示
  - [ ] members から自分を削除
  - [ ] オーナーの場合は退出不可（削除のみ）
- **依存:** T024
- **ステータス:** 未着手

#### T026: グループ削除機能実装
- **対応機能:** F-004
- **完了基準:**
  - [ ] オーナーのみ削除ボタン表示
  - [ ] 確認ダイアログ（メンバーも退出される旨）
  - [ ] グループドキュメント削除
  - [ ] 全メンバーの所属状態クリア
- **依存:** T024
- **ステータス:** 未着手

#### T027: グループメンバー一覧表示実装
- **対応機能:** F-005（S-007）
- **完了基準:**
  - [ ] メンバー一覧取得（リアルタイム）
  - [ ] 各メンバーのニックネーム表示
  - [ ] 自分の表示に「あなた」マーク
  - [ ] オーナーマーク表示
- **依存:** T024
- **ステータス:** 未着手

#### T028: メンバーの今日の達成状況表示実装
- **対応機能:** F-005
- **完了基準:**
  - [ ] 各メンバーの今日の記録取得
  - [ ] ミッション達成率表示
  - [ ] 達成/未達成の視覚的区別
  - [ ] リアルタイム更新（または手動リフレッシュ）
- **依存:** T027, T011
- **ステータス:** 未着手

#### T029: メンバーのストリーク表示実装
- **対応機能:** F-005
- **完了基準:**
  - [ ] 各メンバーのストリーク取得
  - [ ] ストリーク数表示
  - [ ] ストリークランキング表示（オプション）
- **依存:** T028, T018
- **ステータス:** 未着手

#### T030: Firestore セキュリティルール更新（グループ機能）
- **対応機能:** 非機能要件（セキュリティ）
- **完了基準:**
  - [ ] グループメンバーのみがメンバー一覧を読み取り可能
  - [ ] グループメンバーの記録は同グループ内で読み取り可能
  - [ ] 他グループのデータは参照不可
  - [ ] ルールテスト通過
- **依存:** T003, T020
- **ステータス:** 未着手

### Phase 3 完了基準
- [ ] 全タスク（T020〜T030）完了
- [ ] グループ作成・参加・退出・削除が正常動作
- [ ] メンバーの記録がリアルタイムで共有される
- [ ] セキュリティルールが正しく機能

---

## Phase 4: 決済連携

### 目標
- RevenueCatによるサブスクリプション課金
- 無料/有料プランの機能制限
- 達成割引ロジック

### タスク

#### T031: RevenueCat セットアップ
- **対応機能:** F-006
- **完了基準:**
  - [ ] RevenueCat アカウント作成
  - [ ] App Store Connect 連携設定
  - [ ] Offering / Entitlement 設定
  - [ ] API Key 取得・設定
  - [ ] Flutter SDK 導入
- **依存:** T002
- **ステータス:** 未着手

#### T032: App Store Connect サブスクリプション設定
- **対応機能:** F-006
- **完了基準:**
  - [ ] サブスクリプショングループ作成
  - [ ] 月額300円プラン設定
  - [ ] 月額100円プラン設定（達成割引用）
  - [ ] Sandbox テスト設定
- **依存:** なし
- **ステータス:** 未着手

#### T033: Subscription データモデル作成
- **対応機能:** F-006
- **完了基準:**
  - [ ] Subscription エンティティ定義
  - [ ] SubscriptionRepository 実装
  - [ ] RevenueCat との連携ロジック
  - [ ] 課金状態の Firestore 同期
- **依存:** T031
- **ステータス:** 未着手

#### T034: 課金画面実装
- **対応機能:** F-006（S-011）
- **完了基準:**
  - [ ] プラン説明表示
  - [ ] 価格表示（300円/月、達成時100円）
  - [ ] 購入ボタン
  - [ ] 購入フロー実行
  - [ ] 購入成功/失敗のフィードバック
- **依存:** T031, T033
- **ステータス:** 未着手

#### T035: 課金状態管理 Provider 実装
- **対応機能:** F-006
- **完了基準:**
  - [ ] SubscriptionStateProvider 作成
  - [ ] 課金状態のリアルタイム監視
  - [ ] 無料/有料プランの判定ロジック
  - [ ] アプリ起動時の状態復元
- **依存:** T033
- **ステータス:** 未着手

#### T036: 無料プラン機能制限実装
- **対応機能:** F-006
- **完了基準:**
  - [ ] グループ機能のゲート処理
  - [ ] 無料ユーザーにはグループタブ非表示 or 課金誘導
  - [ ] 課金誘導UI表示
  - [ ] ミッション・記録機能は無制限
- **依存:** T035, T024
- **ステータス:** 未着手

#### T037: 達成割引ロジック実装
- **対応機能:** F-006
- **完了基準:**
  - [ ] 月間達成率計算（全ミッション平均）
  - [ ] 達成判定基準定義（例: 80%以上で達成）
  - [ ] 達成フラグを Firestore に保存
  - [ ] 翌月の課金額変更ロジック
- **依存:** T033, T018
- **ステータス:** 未着手

#### T038: サブスクリプションキャンセル機能実装
- **対応機能:** F-006
- **完了基準:**
  - [ ] キャンセル方法の案内表示（App Store設定へ誘導）
  - [ ] キャンセル後の状態反映
  - [ ] 期間終了までは有料機能利用可能
- **依存:** T035
- **ステータス:** 未着手

### Phase 4 完了基準
- [ ] 全タスク（T031〜T038）完了
- [ ] サブスクリプション購入が正常動作
- [ ] 無料/有料の機能制限が正しく動作
- [ ] Sandbox テストで課金フロー確認

---

## Phase 5: プッシュ通知

### 目標
- FCMによるプッシュ通知
- リマインダー機能

### タスク

#### T039: FCM セットアップ
- **対応機能:** F-009
- **完了基準:**
  - [ ] Firebase プロジェクトで FCM 有効化
  - [ ] APNs 証明書設定
  - [ ] Flutter firebase_messaging パッケージ導入
  - [ ] 通知許可リクエスト実装
- **依存:** T002
- **ステータス:** 未着手

#### T040: デバイストークン管理実装
- **対応機能:** F-009
- **完了基準:**
  - [ ] FCM トークン取得
  - [ ] Firestore にトークン保存
  - [ ] トークン更新時の処理
- **依存:** T039
- **ステータス:** 未着手

#### T041: リマインダー設定画面実装
- **対応機能:** F-009
- **完了基準:**
  - [ ] リマインダー ON/OFF トグル
  - [ ] 通知時刻設定（タイムピッカー）
  - [ ] 設定を Firestore に保存
- **依存:** T039
- **ステータス:** 未着手

#### T042: Cloud Functions でスケジュール通知実装
- **対応機能:** F-009
- **完了基準:**
  - [ ] Cloud Functions プロジェクト設定
  - [ ] スケジュール実行関数作成
  - [ ] ユーザーごとの設定時刻で通知送信
  - [ ] 通知タップでアプリ起動
- **依存:** T040, T041
- **ステータス:** 未着手

### Phase 5 完了基準
- [ ] 全タスク（T039〜T042）完了
- [ ] プッシュ通知が届く
- [ ] リマインダー設定が機能する

---

## Phase 6: UI/UX 磨き込み

### 目標
- デザイン品質向上
- ユーザー体験の最適化
- ダークモード対応

### タスク

#### T043: デザインシステム構築
- **対応機能:** 非機能要件（UX）
- **完了基準:**
  - [ ] カラーパレット定義（男性的・シンプル）
  - [ ] タイポグラフィ定義
  - [ ] スペーシングルール定義
  - [ ] 共通コンポーネント作成（ボタン、カード、入力フィールド）
- **依存:** なし
- **ステータス:** 未着手

#### T044: ダークモード対応
- **対応機能:** 非機能要件（UX）
- **完了基準:**
  - [ ] システム設定に追従する ThemeMode 設定
  - [ ] ライト/ダークテーマ定義
  - [ ] 全画面でダークモード表示確認
- **依存:** T043
- **ステータス:** 未着手

#### T045: アニメーション・マイクロインタラクション追加
- **対応機能:** 非機能要件（UX）
- **完了基準:**
  - [ ] 画面遷移アニメーション
  - [ ] 達成時のお祝いアニメーション
  - [ ] ボタンタップフィードバック
  - [ ] プルトゥリフレッシュ
- **依存:** T043
- **ステータス:** 未着手

#### T046: エラー処理・ローディング表示統一
- **対応機能:** 非機能要件（UX）
- **完了基準:**
  - [ ] 共通ローディングコンポーネント
  - [ ] 共通エラー表示コンポーネント
  - [ ] ネットワークエラー時の表示
  - [ ] リトライボタン
- **依存:** なし
- **ステータス:** 未着手

#### T047: オフライン対応
- **対応機能:** 非機能要件（パフォーマンス）
- **完了基準:**
  - [ ] Firestore オフラインキャッシュ有効化
  - [ ] オフライン状態の検知・表示
  - [ ] オフラインでの記録入力対応
  - [ ] オンライン復帰時の同期
- **依存:** T016
- **ステータス:** 未着手

### Phase 6 完了基準
- [ ] 全タスク（T043〜T047）完了
- [ ] 全画面のデザイン統一
- [ ] ダークモード対応
- [ ] オフラインでも基本操作可能

---

## Phase 7: テスト・バグ修正

### 目標
- 品質保証
- バグ修正
- パフォーマンス最適化

### タスク

#### T048: Unit テスト整備
- **対応機能:** 品質保証
- **完了基準:**
  - [ ] Repository 層のテスト
  - [ ] ビジネスロジックのテスト
  - [ ] カバレッジ 70% 以上
- **依存:** 全Phase完了
- **ステータス:** 未着手

#### T049: Integration テスト作成
- **対応機能:** 品質保証
- **完了基準:**
  - [ ] 認証フローのテスト
  - [ ] ミッション作成〜記録フローのテスト
  - [ ] グループ参加フローのテスト
  - [ ] 課金フローのテスト
- **依存:** T048
- **ステータス:** 未着手

#### T050: バグ修正・パフォーマンス改善
- **対応機能:** 品質保証
- **完了基準:**
  - [ ] 発見されたバグの修正
  - [ ] アプリ起動時間 3秒以内
  - [ ] 画面遷移 0.5秒以内
  - [ ] メモリリーク確認・修正
- **依存:** T049
- **ステータス:** 未着手

### Phase 7 完了基準
- [ ] 全タスク（T048〜T050）完了
- [ ] テストカバレッジ基準達成
- [ ] 重大バグなし
- [ ] パフォーマンス基準達成

---

## Phase 8: App Store 審査対応

### 目標
- App Store 提出準備
- 審査通過

### タスク

#### T051: App Store 提出準備
- **対応機能:** リリース
- **完了基準:**
  - [ ] App Store Connect にアプリ登録
  - [ ] スクリーンショット作成（6.7/6.5インチ）
  - [ ] アプリ説明文作成
  - [ ] プライバシーポリシー URL 設定
  - [ ] アプリアイコン設定
- **依存:** T050
- **ステータス:** 未着手

#### T052: App Store 審査提出・対応
- **対応機能:** リリース
- **完了基準:**
  - [ ] TestFlight ビルド提出
  - [ ] App Store 審査提出
  - [ ] リジェクト時の修正対応
  - [ ] 審査通過・公開
- **依存:** T051
- **ステータス:** 未着手

### Phase 8 完了基準
- [ ] 全タスク（T051〜T052）完了
- [ ] App Store で公開

---

## 依存関係サマリー

### 並列実行可能タスク

以下のタスクは依存関係がないため、並列で実行可能：

**Phase 1 開始時:**
- T001（Flutter Setup）完了後：T003, T004, T005 は並列可能

**Phase 4:**
- T032（App Store Subscription設定）は独立して実行可能

**Phase 6:**
- T043（Design System）と T046（Error/Loading）は独立

---

## ブロッカー管理

| ID | タスク | ブロック理由 | 解決策 | ステータス |
|----|--------|-------------|--------|-----------|
| - | - | 現時点でブロッカーなし | - | - |
